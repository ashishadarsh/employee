<div class="modern-modal">
  <div class="modal-header">
    <h3 class="modal-title">{{ title }}</h3>
    <button type="button" class="btn-close" (click)="closePopup()">❌</button>
  </div>

  <form (ngSubmit)="onAddingTask()" [formGroup]="addTaskForm" class="modern-form" *ngIf="addTaskForm">
    <div class="form-body">
      <!-- Title -->
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="titleInput"
          placeholder="Enter Title"
          formControlName="title"
        />
        <label for="titleInput">Title</label>
      </div>

      <div class="form-group">
        <label for="tags" class="tags">Tags</label>
        <div class="tags-input-wrapper" (click)="tagInputField.focus()">
          <span class="tag" *ngFor="let tag of addTaskForm.value.tags; let i = index">
            {{ tag }}
            <span class="tag-close" (click)="removeTag(i)">×</span>
          </span>
          <input
            #tagInputField
            type="text"
            placeholder="Add a tag"
            [(ngModel)]="tagInput"
            [ngModelOptions]="{standalone: true}"
            (keydown.enter)="addTag($event)"
            (blur)="addTag($event)"
          />
        </div>
      </div>

      <!-- Description -->
      <label for="description" style="font-weight: 500; margin-bottom: 0.4rem;">Description</label>
      <div class="NgxEditor__Wrapper">
        <ngx-editor-menu [editor]="editor" [toolbar]="toolbar" id="descriptionMenu"></ngx-editor-menu>
        <ngx-editor [editor]="editor" formControlName="description" id="descriptionEditor"></ngx-editor>
      </div>

      <!-- Status & Assign -->
      <div class="form-row">
        <div class="form-select-group">
          <label for="status">Status</label>
          <select id="status" formControlName="status">
            @for (status of statusOptions; track $index) {
              <option [value]="status.label">{{ status.label }}</option>
            }
          </select>
        </div>

        <div class="form-select-group">
          <label for="teamMember">Assign To</label>
          <select id="teamMember" formControlName="empId">
            @for (teamMemberData of teamData; track $index) {
              <option [value]="teamMemberData._id">{{ teamMemberData.firstName + ' '+ teamMemberData.lastName }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Task Type & Completion Date -->
      <div class="form-row">
        <div class="form-select-group">
          <label for="taskType">Task Type</label>
          <select id="taskType" formControlName="type">
            @for (type of tasksType; track $index) {
              <option [value]="type.label">{{ type.label }}</option>
            }
          </select>
        </div>

        <div class="form-select-group">
          <label for="completionDate">Completion Date</label>
          <input type="date" id="completionDate" formControlName="completionDate" />
        </div>
      </div>
    </div>

    <!-- Fixed Buttons -->
    <div class="modal-buttons fixed-buttons">
      <p-button
        label="Cancel"
        icon="pi pi-arrow-left"
        variant="outlined"
        styleClass="p-button-danger"
        [raised]="true"
        (click)="closePopup()"
      ></p-button>
      <p-button
        label="Save"
        icon="pi pi-save"
        variant="outlined"
        styleClass="p-button-success"
        type="submit"
        [raised]="true"
        [disabled]="!addTaskForm.valid || loading"
      ></p-button>
    </div>
  </form>
</div>
